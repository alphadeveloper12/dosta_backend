{% extends 'kitchen/base.html' %} {% block content %}
<div class="container mx-auto px-4 py-8">
 <div class="mb-8">
  <h1 class="text-3xl font-bold text-gray-800 mb-2">Update Vending Prices</h1>
  <p class="text-gray-600">
   Upload an Excel or CSV file to update menu item prices.
  </p>
 </div>

 <!-- Upload Form -->
 <div class="bg-white rounded-lg shadow-md p-6 mb-8">
  <form method="post" enctype="multipart/form-data" class="space-y-4">
   {% csrf_token %}
   <div class="flex items-center space-x-4">
    <div class="flex-1">
     <label
      for="price_file"
      class="block text-sm font-medium text-gray-700 mb-2"
      >Choose File (XLSX, XLS, CSV)</label
     >
     <input
      type="file"
      name="price_file"
      id="price_file"
      class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
      accept=".csv, .xlsx, .xls"
      required />
    </div>
    <button
     type="submit"
     class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
     Upload & Update
    </button>
   </div>
   <p class="text-xs text-gray-500 mt-2">
    Expected columns: <strong>Item</strong> and <strong>Price</strong>. Match is
    case-insensitive and ignores '*' symbol.
   </p>
  </form>
 </div>

 {% if messages %}
 <div class="mb-8">
  {% for message in messages %}
  <div
   class="p-4 rounded-md {% if message.tags == 'success' %}bg-green-100 text-green-700{% else %}bg-red-100 text-red-700{% endif %}">
   {{ message }}
  </div>
  {% endfor %}
 </div>
 {% endif %}

 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
  <!-- Not Found Items -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
   <div class="bg-red-50 px-6 py-4 border-b border-red-100">
    <h2 class="text-xl font-semibold text-red-800">
     Items Not Found ({{ not_found_items|length }})
    </h2>
    <p class="text-sm text-red-600">
     These items from the sheet were not found in the database.
    </p>
   </div>
   <div class="overflow-x-auto max-h-96">
    <table class="min-w-full divide-y divide-gray-200">
     <thead class="bg-gray-50">
      <tr>
       <th
        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        Item Name (Sheet)
       </th>
       <th
        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        Sheet Price
       </th>
      </tr>
     </thead>
     <tbody class="bg-white divide-y divide-gray-200">
      {% for item in not_found_items %}
      <tr class="hover:bg-gray-50">
       <td class="px-6 py-4 text-sm text-gray-900">{{ item.name }}</td>
       <td class="px-6 py-4 text-sm text-gray-500">{{ item.price }}</td>
      </tr>
      {% empty %}
      <tr>
       <td colspan="2" class="px-6 py-4 text-sm text-gray-500 text-center">
        No unmatched items.
       </td>
      </tr>
      {% endfor %}
     </tbody>
    </table>
   </div>
  </div>

  <!-- Updated Items -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
   <div class="bg-green-50 px-6 py-4 border-b border-green-100">
    <h2 class="text-xl font-semibold text-green-800">
     Updated Items ({{ updated_items|length }})
    </h2>
    <p class="text-sm text-green-600">These items had their prices updated.</p>
   </div>
   <div class="overflow-x-auto max-h-96">
    <table class="min-w-full divide-y divide-gray-200">
     <thead class="bg-gray-50">
      <tr>
       <th
        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        Item Name
       </th>
       <th
        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        Old Price
       </th>
       <th
        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
        New Price
       </th>
      </tr>
     </thead>
     <tbody class="bg-white divide-y divide-gray-200">
      {% for item in updated_items %}
      <tr class="hover:bg-gray-50">
       <td class="px-6 py-4 text-sm text-gray-900">{{ item.name }}</td>
       <td class="px-6 py-4 text-sm text-gray-500 line-through">
        {{ item.old_price }}
       </td>
       <td class="px-6 py-4 text-sm font-semibold text-green-600">
        {{ item.new_price }}
       </td>
      </tr>
      {% empty %}
      <tr>
       <td colspan="3" class="px-6 py-4 text-sm text-gray-500 text-center">
        No price updates needed.
       </td>
      </tr>
      {% endfor %}
     </tbody>
    </table>
   </div>
  </div>
 </div>
</div>
{% endblock %}
