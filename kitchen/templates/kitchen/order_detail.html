{% extends 'kitchen/base.html' %} {% block content %}
<div class="mb-6">
  <a href="{% url 'kitchen:dashboard' %}" class="text-blue-500 hover:text-blue-700">‚Üê Back to Dashboard</a>
</div>

<div class="bg-white shadow overflow-hidden sm:rounded-lg">
  <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
    <div>
      <h3 class="text-lg leading-6 font-medium text-gray-900">
        Order #{{ order.id }} Details
      </h3>
      <p class="mt-1 max-w-2xl text-sm text-gray-500">
        Created: {{ order.created_at }}
      </p>
    </div>
    <div class="flex space-x-2">
      <form method="POST" action="{% url 'kitchen:update_order_status' order.id %}">
        {% csrf_token %} {% if order.status == 'PENDING' %}
        <button name="status" value="PREPARING"
          class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
          Start Preparing
        </button>
        {% elif order.status == 'PREPARING' %}
        <button name="status" value="READY"
          class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
          Mark Ready
        </button>
        {% elif order.status == 'READY' %}
        <button name="status" value="COMPLETED"
          class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
          Complete Order
        </button>
        {% endif %}
      </form>
    </div>
  </div>

  <div class="border-t border-gray-200">
    <dl>
      <!-- Customer -->
      <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">Customer</dt>
        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
          {{ order.user.email|default:order.user.username }}
        </dd>
      </div>

      <!-- Plan Type -->
      <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">Plan Type</dt>
        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
          {{ order.plan_type }} / {{ order.plan_subtype }}
        </dd>
      </div>

      <!-- Pickup Info -->
      <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">Pickup Details</dt>
        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
          {{ order.pickup_type }} <br />
          Date: {{ order.pickup_date }} <br />
          {% if order.pickup_slot %} Slot: {{ order.pickup_slot.label }} {% endif %}
        </dd>
      </div>

      <!-- Items List -->
      <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">Items</dt>
        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
          <ul class="border border-gray-200 rounded-md divide-y divide-gray-200">
            {% for item in order.items.all %}
            {% if item.plan_type == 'START_PLAN' %}
            <li class="pl-3 pr-4 py-3 text-sm">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <h4 class="font-bold text-lg text-gray-900">
                    {{ item.menu_item.name }}
                  </h4>
                  <p class="text-gray-600 mt-1">
                    {{ item.menu_item.description|default:"No description available." }}
                  </p>
                  {% if item.menu_item.offer %}
                  <p class="text-green-600 text-xs mt-1 font-semibold">
                    Offer: {{ item.menu_item.offer }}
                  </p>
                  {% endif %}
                </div>
                <div class="ml-4 flex-shrink-0 font-bold text-lg">
                  x {{ item.quantity }}
                </div>
              </div>
              {% if item.menu_item.image %}
              <div class="mt-2">
                <img src="{{ item.menu_item.image.url }}" alt="{{ item.menu_item.name }}"
                  class="h-20 w-20 object-cover rounded shadow-sm" />
              </div>
              {% endif %}
            </li>
            {% endif %}
            {% endfor %}
          </ul>
        </dd>
      </div>

      <!-- Total -->
      <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">Total Amount</dt>
        <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2 font-bold text-xl">
          ${{ order.total_amount }}
        </dd>
      </div>
    </dl>
  </div>
</div>
{% endblock %}